<html>
<head>
    <title>Accio</title>
</head>
<body style='background-color: #444; '>
    <div style='width: 200px; height: 100%; float: left; margin: 0px; padding: 0px;' id='l' >
    </div>
    <div style='width: 100%; height: 100%; margin: 0px; padding: 0px;'>
        <div style='height: 40px;'>
            <input style='width: calc(100% - 328px); height: 32px; font-family: monospace; background-color: #fff; border: 0px; margin: 0px; padding: 4px; ' id='t' />
            <input style='width: 60px; height: 32px; font-family: monospace; background-color: #fff; border: 0px; margin: 0px; padding: 0px; ' type='button' value='save' onclick='saveKeyClick()' />
            <input style='width: 60px; height: 32px; font-family: monospace; background-color: #fff; border: 0px; margin: 0px; padding: 0px; ' type='button' value='delete' onclick='deleteKeyClick()' />
        </div>
        <div style='height: calc(100% - 40px);'>
            <textarea style='width: calc(100% - 200px); height: 100%; font-family: monospace; background-color: #fff; border: 0px; margin: 0px; padding: 4px;' id='c'>
            </textarea>
        </div>
    </div>
    <script>
        const title = decodeURIComponent(window.location.search.substring(1));

        const divList = document.getElementById('l');
        const textboxTitle = document.getElementById('t');
        const textboxContent = document.getElementById('c');

        divList.innerHTML += '<div style=\'margin: 4px 4px 16px 4px;\'><a style=\'color: #fff; text-decoration: none;\' href=\'?\'>new</a></div>';

        Object.keys(localStorage).sort().forEach((key) => {
            if (key.startsWith('accio_')) {
                const n = key.substring(6);
                divList.innerHTML += '<div style=\'margin: 4px;\'><a style=\'color: #fff; text-decoration: none;\' href=\'?' + n + '\'>' + n + '</a></div>';
            }
        });

        textboxTitle.value = title;
        textboxContent.value = title == '' ? '' : localStorage.getItem('accio_' + title);

        function saveKeyClick() {
            if (textboxTitle.value.trim() != '') {
                const newTitle = textboxTitle.value.trim();
                localStorage.setItem('accio_' + newTitle, textboxContent.value);
                if (newTitle != title) {
                    window.location.search = newTitle;
                }
            }
        }

        function deleteKeyClick() {
            if (textboxTitle.value.trim() != '') {
                localStorage.removeItem('accio_' + title);
                window.location.search = '';
            }
        }
    </script>
</body>
</html>
